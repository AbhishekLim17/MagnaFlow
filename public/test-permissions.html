<!DOCTYPE html>
<html>
<head>
  <title>Firestore Permission Test</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, getDocs, getDoc, doc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCEqJyUx-ZgUBOuJqxL3rnVZ4DYM-cjURA",
      authDomain: "magnaflow-07sep25.firebaseapp.com",
      projectId: "magnaflow-07sep25",
      storageBucket: "magnaflow-07sep25.firebasestorage.app",
      messagingSenderId: "644738925397",
      appId: "1:644738925397:web:0a1c0faa7b80e2caa9a5f6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function testPermissions() {
      const log = document.getElementById('log');
      
      try {
        log.innerHTML += '<p>üîç Testing Tasks Collection...</p>';
        const tasksSnapshot = await getDocs(collection(db, 'tasks'));
        log.innerHTML += `<p style="color: green;">‚úÖ Tasks: ${tasksSnapshot.size} documents</p>`;
        
        tasksSnapshot.forEach(doc => {
          const data = doc.data();
          log.innerHTML += `<p>  - ${data.title} (${data.priority || 'no priority'})</p>`;
        });
      } catch (error) {
        log.innerHTML += `<p style="color: red;">‚ùå Tasks Error: ${error.message}</p>`;
        log.innerHTML += `<p style="color: red;">Code: ${error.code}</p>`;
      }

      try {
        log.innerHTML += '<p>üîç Testing Users Collection...</p>';
        const usersSnapshot = await getDocs(collection(db, 'users'));
        log.innerHTML += `<p style="color: green;">‚úÖ Users: ${usersSnapshot.size} documents</p>`;
        
        usersSnapshot.forEach(doc => {
          const data = doc.data();
          log.innerHTML += `<p>  - ${data.name} (${data.email})</p>`;
        });
      } catch (error) {
        log.innerHTML += `<p style="color: red;">‚ùå Users Error: ${error.message}</p>`;
        log.innerHTML += `<p style="color: red;">Code: ${error.code}</p>`;
      }

      try {
        log.innerHTML += '<p>üîç Testing Reminder Logs Collection...</p>';
        const logsSnapshot = await getDocs(collection(db, 'reminder_logs'));
        log.innerHTML += `<p style="color: green;">‚úÖ Reminder Logs: ${logsSnapshot.size} documents</p>`;
      } catch (error) {
        log.innerHTML += `<p style="color: red;">‚ùå Reminder Logs Error: ${error.message}</p>`;
      }
    }

    window.onload = () => {
      testPermissions();
    };
  </script>
</head>
<body>
  <h1>Firestore Permission Test (Unauthenticated)</h1>
  <div id="log"></div>
</body>
</html>
